#!/bin/bash

QUIET=0

# function to restart php-fpm, using quiet if necessary
restart_php_fpm () {
  if [ $QUIET -eq 1 ]; then
    sv restart php-fpm > /dev/null
  else
    sv restart php-fpm
  fi
}

# handle opts
while getopts ":q" option; do
  case $option in
    q)
      QUIET=1
      ;;
    *)
      echo "Bad option ${option} provided)"
      exit 1
      ;;
  esac
done

shift "$((OPTIND -1))"

DIRECTION=$1

# Handle Args
case $DIRECTION in

  on)
    if [ $QUIET -eq 0 ]; then
      echo "enabling xdebug, using always on settings, restarting php-fpm"
    fi

    phpdismod xdebug-on xdebug-trigger
    phpenmod xdebug-on
    restart_php_fpm
    ;;

  off)
    if [ $QUIET -eq 0 ]; then
      echo "disabling xdebug, restarting php-fpm"
    fi

    phpdismod xdebug-on xdebug-trigger
    restart_php_fpm
    ;;

  trigger)
    if [ $QUIET -eq 0 ]; then
      echo "enabling xdebug, using trigger settings, restarting php-fpm"
    fi

    phpdismod xdebug-on xdebug-trigger
    phpenmod xdebug-trigger
    restart_php_fpm
    ;;

  *)
    echo "must be one of on, off, or trigger"
    ;;
esac
